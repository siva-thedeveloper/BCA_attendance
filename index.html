<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tirukkoilur College Attendance System</title>
    <!-- Lucide Icons Library -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ========================================
           CSS STYLES (Equates to style.css)
           ========================================
        */
        :root {
            --primary: #4338ca; /* Indigo 700 */
            --primary-light: #e0e7ff; /* Indigo 100 */
            --secondary: #1e293b; /* Slate 800 */
            --accent: #10b981; /* Emerald 500 */
            --danger: #f43f5e; /* Rose 500 */
            --bg-body: #f8fafc; /* Slate 50 */
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--secondary);
            line-height: 1.5;
            min-height: 100vh;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .grid { display: grid; }
        
        /* Layout & Scrolling */
        .app-container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding-bottom: 50px;
        }

        /* HEADER DESIGN */
        .main-header {
            background: var(--white);
            border-bottom: 1px solid #e2e8f0;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            box-shadow: var(--shadow);
        }

        .logo-box {
            width: 70px;
            height: 70px;
            background: var(--primary-light);
            border: 2px solid var(--primary);
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            flex-shrink: 0;
        }

        .center-branding {
            text-align: center;
            flex-grow: 1;
        }

        .college-name {
            font-size: 1.5rem;
            font-weight: 900;
            color: #0f172a;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .dept-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--primary);
            color: white;
            padding: 0.4rem 1.2rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 800;
            margin-top: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            box-shadow: 0 4px 10px rgba(67, 56, 202, 0.2);
        }

        /* LOGIN SCREEN */
        .login-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4rem 1rem;
        }

        .login-card {
            background: var(--white);
            width: 100%;
            max-width: 400px;
            border-radius: 2.5rem;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        .login-banner {
            background: var(--primary);
            padding: 3rem 2rem;
            text-align: center;
            color: white;
        }

        .login-form {
            padding: 2.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group i {
            position: absolute;
            left: 1rem;
            top: 1.1rem;
            color: #94a3b8;
        }

        .input-field {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            font-size: 1rem;
            font-weight: 600;
            outline: none;
            transition: all 0.2s;
        }

        .input-field:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(67, 56, 202, 0.1);
        }

        /* BUTTONS */
        .btn {
            cursor: pointer;
            border: none;
            border-radius: 1rem;
            padding: 1rem 1.5rem;
            font-weight: 800;
            font-size: 0.875rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s;
            text-transform: uppercase;
        }

        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #3730a3; transform: translateY(-2px); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-emerald { background: var(--accent); color: white; }

        /* DASHBOARD GRID */
        .dashboard {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card {
            background: white;
            border-radius: 2rem;
            padding: 2rem;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            padding: 1.5rem;
            border-radius: 1.5rem;
            background: var(--secondary);
            color: white;
        }

        /* TABLES */
        .table-container {
            overflow-x: auto;
            border-radius: 1.5rem;
            background: white;
            border: 1px solid #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }

        th {
            background: #f8fafc;
            padding: 1.25rem 1.5rem;
            font-size: 0.75rem;
            font-weight: 800;
            color: #64748b;
            text-transform: uppercase;
        }

        td {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid #f1f5f9;
            font-weight: 600;
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsive Branding */
        @media (max-width: 768px) {
            .main-header { flex-direction: column; text-align: center; }
            .college-name { font-size: 1.1rem; }
            .logo-box { width: 50px; height: 50px; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- HEADER COMPONENT -->
        <header class="main-header">
            <div class="logo-box">
                <i data-lucide="school"></i>
            </div>
            <div class="center-branding">
                <h1 class="college-name">Tirukkoilur College <br> Of Arts and Science</h1>
                <div class="dept-badge">
                    <i data-lucide="book-open" style="width: 14px;"></i>
                    Department of Computer Applications (BCA)
                </div>
            </div>
            <div class="logo-box" style="border-color: #cbd5e1; color: #94a3b8;">
                <i data-lucide="award"></i>
            </div>
        </header>

        <!-- LOGIN SCREEN -->
        <div id="loginSection" class="login-screen">
            <div class="login-card">
                <div class="login-banner">
                    <h2 style="font-size: 2rem; font-weight: 900;">Portal Access</h2>
                    <p style="opacity: 0.8; font-weight: 600;">Secure Academic Gateway</p>
                </div>
                <div class="login-form">
                    <div id="loginError" class="hidden" style="background: #fff1f2; color: #e11d48; padding: 1rem; border-radius: 1rem; margin-bottom: 1.5rem; font-weight: 700; font-size: 0.875rem;">
                        Invalid credentials. Try again.
                    </div>
                    <div class="form-group">
                        <i data-lucide="user"></i>
                        <input type="text" id="username" class="input-field" placeholder="Username">
                    </div>
                    <div class="form-group">
                        <i data-lucide="lock"></i>
                        <input type="password" id="password" class="input-field" placeholder="Password">
                    </div>
                    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 2rem;">
                        <button onclick="handleLogin('staff')" class="btn btn-primary">
                            <i data-lucide="users"></i> Staff
                        </button>
                        <button onclick="handleLogin('admin')" class="btn btn-secondary">
                            <i data-lucide="settings"></i> Admin
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="adminSection" class="dashboard hidden">
            <div class="page-header">
                <div>
                    <h2 style="font-size: 2rem; font-weight: 900;">Admin Control</h2>
                    <p style="color: #64748b; font-weight: 600;">Managing Academic Staff</p>
                </div>
                <button onclick="logout()" class="btn btn-danger">
                    <i data-lucide="log-out"></i> Logout
                </button>
            </div>

            <div class="grid" style="grid-template-columns: 1fr; gap: 2rem;">
                <!-- Staff Form Card -->
                <div class="card">
                    <h3 id="staffFormTitle" style="margin-bottom: 1.5rem; font-weight: 900;">Add New Faculty</h3>
                    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <input type="text" id="staffName" class="input-field" placeholder="Full Name" style="padding-left: 1rem;">
                        <input type="text" id="staffUser" class="input-field" placeholder="Login ID" style="padding-left: 1rem;">
                        <input type="text" id="staffPass" class="input-field" placeholder="Password" style="padding-left: 1rem;">
                        <button onclick="addOrUpdateStaff()" class="btn btn-primary" id="staffActionBtn">
                            <i data-lucide="plus"></i> Enroll Staff
                        </button>
                    </div>
                </div>

                <!-- Staff List Card -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Faculty Member</th>
                                <th>Credentials</th>
                                <th style="text-align: right;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="staffTableBody">
                            <!-- JS injected rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- STAFF DASHBOARD -->
        <div id="staffSection" class="dashboard hidden">
            <div class="page-header">
                <div class="flex" style="align-items: center; gap: 1rem;">
                    <div style="background: var(--primary); color: white; padding: 1rem; border-radius: 1.5rem;">
                        <i data-lucide="users"></i>
                    </div>
                    <div>
                        <h2 id="welcomeStaff" style="font-size: 1.5rem; font-weight: 900;">Attendance Register</h2>
                        <div class="flex" style="gap: 1rem; margin-top: 0.25rem;">
                             <select id="yearSelect" onchange="renderStudents()" style="background: none; border: none; font-weight: 700; color: var(--primary); cursor: pointer;">
                                <option>1st Year</option>
                                <option>2nd Year</option>
                                <option>3rd Year</option>
                             </select>
                             <select id="sectionSelect" onchange="renderStudents()" style="background: none; border: none; font-weight: 700; color: var(--primary); cursor: pointer;">
                                <option>A</option>
                                <option>B</option>
                             </select>
                        </div>
                    </div>
                </div>
                <div class="flex" style="gap: 0.5rem;">
                    <button id="toggleManageBtn" onclick="toggleManageMode()" class="btn btn-secondary" style="background: #f1f5f9; color: #475569;">
                        <i data-lucide="user-cog"></i> Manager
                    </button>
                    <button onclick="logout()" class="btn btn-danger">
                        <i data-lucide="log-out"></i>
                    </button>
                </div>
            </div>

            <div class="grid" style="grid-template-columns: 1fr; gap: 2rem;">
                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card" style="background: var(--secondary);">
                        <p style="font-size: 0.75rem; font-weight: 800; opacity: 0.6; text-transform: uppercase;">Total Students</p>
                        <h4 id="totalCount" style="font-size: 2rem; font-weight: 900;">0</h4>
                    </div>
                    <div class="stat-card" style="background: #059669;">
                        <p style="font-size: 0.75rem; font-weight: 800; opacity: 0.8; text-transform: uppercase;">Present</p>
                        <h4 id="presentCount" style="font-size: 2rem; font-weight: 900;">0</h4>
                    </div>
                    <div class="stat-card" style="background: #e11d48;">
                        <p style="font-size: 0.75rem; font-weight: 800; opacity: 0.8; text-transform: uppercase;">Absent</p>
                        <h4 id="absentCount" style="font-size: 2rem; font-weight: 900;">0</h4>
                    </div>
                </div>

                <!-- Student Manager Form (Hidden initially) -->
                <div id="studentManagerCard" class="card hidden" style="border-color: var(--primary);">
                    <h3 id="studentFormTitle" style="margin-bottom: 1.5rem; font-weight: 900;">Enroll New Student</h3>
                    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <input type="text" id="studentRoll" class="input-field" placeholder="Roll Number" style="padding-left: 1rem;">
                        <input type="text" id="studentName" class="input-field" placeholder="Student Name" style="padding-left: 1rem;">
                        <button onclick="addOrUpdateStudent()" class="btn btn-primary" id="studentActionBtn">
                            Confirm
                        </button>
                    </div>
                </div>

                <!-- Student List -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Roll No.</th>
                                <th>Student Name</th>
                                <th style="text-align: center;">Control / Status</th>
                            </tr>
                        </thead>
                        <tbody id="studentTableBody">
                            <!-- JS injected -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <footer style="text-align: center; margin-top: 4rem; padding-bottom: 2rem;">
            <p style="font-size: 0.75rem; font-weight: 800; color: #94a3b8; letter-spacing: 0.2em; text-transform: uppercase;">
                BCA Exhibition 2024 â€¢ Digital Register v4.2
            </p>
        </footer>
    </div>

    <!-- 
       ========================================
       JAVASCRIPT (Equates to script.js)
       ========================================
    -->
    <script>
        // Initial Data Structure
        let staffList = [
            { id: 1, name: "Prof. Anbarasan", username: "staff123", password: "password123" },
            { id: 2, name: "Dr. Kavitha", username: "kavitha", password: "staffpassword" }
        ];

        let masterStudentData = {
            "1st Year-A": [{ roll: "24BCAA01", name: "Aravind K" }, { roll: "24BCAA02", name: "Baskar M" }],
            "1st Year-B": [{ roll: "24BCAB01", name: "John Doe" }],
            "2nd Year-A": [{ roll: "23BCAA01", name: "Suresh Kumar" }],
            "2nd Year-B": [{ roll: "23BCAB01", name: "Priya V" }],
            "3rd Year-A": [{ roll: "22BCAA01", name: "Vijay R" }],
            "3rd Year-B": [{ roll: "22BCAB01", name: "Meena S" }]
        };

        let attendanceRecords = {}; // Key: "Year-Section-Roll", Value: "present" or "absent"
        let activeStaff = null;
        let isManageMode = false;
        let editingStaffId = null;
        let editingStudentRoll = null;

        // AUTHENTICATION
        function handleLogin(role) {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');

            if (role === 'admin') {
                if (user === 'admin' && pass === 'admin123') {
                    showSection('admin');
                } else {
                    errorDiv.classList.remove('hidden');
                }
            } else {
                const staff = staffList.find(s => s.username === user && s.password === pass);
                if (staff) {
                    activeStaff = staff;
                    document.getElementById('welcomeStaff').innerText = `Register: ${staff.name}`;
                    showSection('staff');
                } else {
                    errorDiv.classList.remove('hidden');
                }
            }
        }

        function logout() {
            activeStaff = null;
            isManageMode = false;
            showSection('login');
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showSection(section) {
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('adminSection').classList.add('hidden');
            document.getElementById('staffSection').classList.add('hidden');
            document.getElementById(section + 'Section').classList.remove('hidden');
            
            if (section === 'admin') renderStaff();
            if (section === 'staff') renderStudents();
            wind
